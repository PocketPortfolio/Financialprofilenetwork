(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[533],{2074:function(e,t,r){Promise.resolve().then(r.bind(r,9264))},7429:function(e,t,r){"use strict";r.d(t,{$C:function(){return i},Kg:function(){return o},vR:function(){return n}});var a=r(2265);function n(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];let[t,r]=(0,a.useState)(null),[n,o]=(0,a.useState)(!1),[i,s]=(0,a.useState)(null),l=(0,a.useRef)(null),c=(0,a.useRef)(!0),d=(0,a.useRef)(0),u=(0,a.useMemo)(()=>(null==e?void 0:e.join(","))||"",[e]),h=(0,a.useCallback)(async()=>{if(!c.current)return;if(!e||0===e.length){r({}),o(!1),s(null);return}let t=Date.now(),a="quotes_".concat(u),n=localStorage.getItem(a);if(n&&t-d.current<6e5)try{let e=JSON.parse(n);if(c.current){r(e);return}}catch(e){}o(!0),s(null);try{let n=e.join(","),o=await fetch("/api/quote?symbols=".concat(n));if(!o.ok)throw Error("HTTP error! status: ".concat(o.status));let i=await o.json();if(c.current){let e={};i.forEach(t=>{e[t.symbol]=t}),r(e),localStorage.setItem(a,JSON.stringify(e)),d.current=t}}catch(e){c.current&&s(e instanceof Error?e.message:"Failed to fetch quotes")}finally{c.current&&o(!1)}},[u]);return(0,a.useEffect)(()=>(c.current=!0,h(),()=>{c.current=!1,l.current&&clearInterval(l.current)}),[u]),{data:t,loading:n,error:i,refetch:h}}function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,[r,n]=(0,a.useState)(null),[o,i]=(0,a.useState)(!1),[s,l]=(0,a.useState)(null),c=(0,a.useRef)(null),d=(0,a.useRef)(!0),u=(0,a.useRef)(0),h=(0,a.useMemo)(()=>e.join(","),[e]),p=(0,a.useCallback)(async()=>{if(!d.current)return;let r=Date.now(),a="news_".concat(h,"_").concat(t),o=localStorage.getItem(a);if(o&&r-u.current<9e5)try{let e=JSON.parse(o);if(d.current){n(e);return}}catch(e){}i(!0),l(null);try{let o=new URLSearchParams;e.length>0&&o.append("tickers",h),o.append("limit",t.toString());let i=await fetch("/api/news?".concat(o));if(!i.ok)throw Error("HTTP error! status: ".concat(i.status));let s=await i.json();d.current&&(n(s),localStorage.setItem(a,JSON.stringify(s)),u.current=r)}catch(e){d.current&&l(e instanceof Error?e.message:"Failed to fetch news")}finally{d.current&&i(!1)}},[h,t]);return(0,a.useEffect)(()=>(d.current=!0,p(),()=>{d.current=!1,c.current&&clearInterval(c.current)}),[h,t]),{data:r,loading:o,error:s,refetch:p}}function i(){let[e,t]=(0,a.useState)(null),[r,n]=(0,a.useState)(!1),[o,i]=(0,a.useState)(null),s=(0,a.useRef)(null),l=(0,a.useRef)(!0),c=(0,a.useRef)(0),d=(0,a.useCallback)(async()=>{if(!l.current)return;let e=Date.now(),r="market_data_most_traded",a=localStorage.getItem(r);if(a&&e-c.current<9e5)try{let e=JSON.parse(a);if(l.current){t(e);return}}catch(e){}n(!0),i(null);try{let a=await fetch("/api/most-traded?count=10&region=US");if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let n=await a.json();l.current&&(t(n),localStorage.setItem(r,JSON.stringify(n)),c.current=e)}catch(e){l.current&&i(e instanceof Error?e.message:"Failed to fetch market data")}finally{l.current&&n(!1)}},[]);return(0,a.useEffect)(()=>(l.current=!0,d(),()=>{l.current=!1,s.current&&clearInterval(s.current)}),[]),{data:e,loading:r,error:o,refetch:d}}},9264:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return h}});var a=r(7437),n=r(2265),o=r(4330),i=r(5978),s=r(7835);class l{static async getWatchlist(e){try{if(!s.db)throw Error("Firebase database not initialized");let t=(0,i.IO)((0,i.hJ)(s.db,"watchlist"),(0,i.ar)("uid","==",e));return(await (0,i.PL)(t)).docs.map(e=>({id:e.id,...e.data()})).sort((e,t)=>{var r,a;let n=(null===(r=e.createdAt)||void 0===r?void 0:r.toMillis())||0;return((null===(a=t.createdAt)||void 0===a?void 0:a.toMillis())||0)-n})}catch(e){if("permission-denied"===e.code)throw Error("Permission denied. Please ensure you are signed in.");if(e.message)throw Error(e.message);throw Error("Failed to fetch watchlist. Please try again.")}}static async addToWatchlist(e,t,r){try{let a=(0,i.IO)((0,i.hJ)(s.db,"watchlist"),(0,i.ar)("uid","==",e),(0,i.ar)("symbol","==",t.toUpperCase()));if(!(await (0,i.PL)(a)).empty)throw Error("".concat(t.toUpperCase()," is already in your watchlist"));await (0,i.ET)((0,i.hJ)(s.db,"watchlist"),{symbol:t.toUpperCase(),name:r,uid:e,createdAt:i.EK.now(),updatedAt:i.EK.now()})}catch(e){throw e}}static async removeFromWatchlist(e,t){try{if(!s.db)throw Error("Firebase database not initialized");let r=(0,i.JU)(s.db,"watchlist",t),a=await (0,i.QT)(r);if(!a.exists())throw Error("Watchlist item not found");if(a.data().uid!==e)throw Error("Insufficient permissions to remove this watchlist item");await (0,i.oe)(r)}catch(e){if("permission-denied"===e.code)throw Error("Permission denied. Please ensure you are signed in and own this item.");if("not-found"===e.code)throw Error("Watchlist item not found. It may have already been removed.");if(e.message)throw Error(e.message);throw Error("Failed to remove watchlist item. Please try again.")}}}var c=r(7429),d=r(8483),u=r(5687);function h(){let{isAuthenticated:e,user:t,signInWithGoogle:r,logout:i}=(0,o.a)(),{watchlist:s,loading:h,error:p,addToWatchlist:x,removeFromWatchlist:g}=function(){let{isAuthenticated:e,user:t}=(0,o.a)(),[r,a]=(0,n.useState)([]),[i,s]=(0,n.useState)(!0),[d,u]=(0,n.useState)(null),h=r.map(e=>e.symbol),{data:p,loading:x}=(0,c.vR)(h,3e4),g=(0,n.useCallback)(async()=>{if(!e||!t){a([]),s(!1);return}try{s(!0),u(null);let e=await l.getWatchlist(t.uid);a(e)}catch(e){u(e instanceof Error?e.message:"Failed to load watchlist")}finally{s(!1)}},[e,t]),f=(0,n.useCallback)(async(r,a)=>{if(!e||!t)throw Error("Must be signed in to add to watchlist");try{await l.addToWatchlist(t.uid,r,a),await g()}catch(e){throw e}},[e,t,g]),m=(0,n.useCallback)(async r=>{if(!e||!t)throw Error("Must be signed in to remove from watchlist");try{await l.removeFromWatchlist(t.uid,r),await g()}catch(e){throw e}},[e,t,g]);return(0,n.useEffect)(()=>{p&&r.length>0&&a(r.map(e=>{let t=p[e.symbol];return t&&void 0!==t.price?{...e,price:t.price,change:t.change,changePercent:t.changePct,currency:t.currency,lastUpdated:new Date().toISOString()}:e}))},[p]),(0,n.useEffect)(()=>{g()},[g]),{watchlist:r,loading:i||x,error:d,addToWatchlist:f,removeFromWatchlist:m,loadWatchlist:g}}(),[f,m]=(0,n.useState)(""),[y,v]=(0,n.useState)([]),[b,w]=(0,n.useState)(!1),[S,j]=(0,n.useState)(!1),k=(0,n.useCallback)(async e=>{if(e.length<2){v([]),w(!1);return}j(!0);try{let t=[{symbol:"AAPL",name:"Apple Inc.",exchange:"NASDAQ"},{symbol:"TSLA",name:"Tesla Inc.",exchange:"NASDAQ"},{symbol:"MSFT",name:"Microsoft Corporation",exchange:"NASDAQ"},{symbol:"GOOGL",name:"Alphabet Inc.",exchange:"NASDAQ"},{symbol:"AMZN",name:"Amazon.com Inc.",exchange:"NASDAQ"},{symbol:"NVDA",name:"NVIDIA Corporation",exchange:"NASDAQ"},{symbol:"META",name:"Meta Platforms Inc.",exchange:"NASDAQ"},{symbol:"VOD.L",name:"Vodafone Group PLC",exchange:"LSE"},{symbol:"TSCO.L",name:"Tesco PLC",exchange:"LSE"},{symbol:"BP.L",name:"BP PLC",exchange:"LSE"}].filter(t=>t.symbol.toLowerCase().includes(e.toLowerCase())||t.name.toLowerCase().includes(e.toLowerCase()));v(t.slice(0,5)),w(!0)}catch(e){}finally{j(!1)}},[]);(0,n.useEffect)(()=>{let e=setTimeout(()=>{f.trim()?k(f):(v([]),w(!1))},300);return()=>clearTimeout(e)},[f,k]);let C=async e=>{if(e.preventDefault(),f.trim())try{if(s.some(e=>e.symbol===f.toUpperCase())){alert("".concat(f.toUpperCase()," is already in your watchlist"));return}let e=y.find(e=>e.symbol===f.toUpperCase()),t=e?e.name:"".concat(f.toUpperCase()," Corp.");await x(f.toUpperCase(),t),m(""),w(!1)}catch(e){alert(e instanceof Error?e.message:"Failed to add to watchlist")}},E=e=>{m(e.symbol),w(!1)},A=async e=>{try{await g(e)}catch(e){alert(e instanceof Error?e.message:"Failed to remove from watchlist")}};return e?(0,a.jsxs)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"var(--bg)",color:"var(--text)"},children:[(0,a.jsx)(d.Z,{title:"Watchlist - Pocket Portfolio",description:"Track your favorite stocks and investments"}),(0,a.jsx)(u.Z,{title:"Watchlist"}),(0,a.jsxs)("main",{style:{flex:1,padding:"20px",maxWidth:"1200px",margin:"0 auto",width:"100%"},children:[(0,a.jsx)("div",{style:{marginBottom:"32px"},children:(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",marginBottom:"16px"},children:[(0,a.jsx)("div",{style:{width:"48px",height:"48px",borderRadius:"12px",background:"linear-gradient(135deg, var(--accent-warm) 0%, #f59e0b 100%)",display:"flex",alignItems:"center",justifyContent:"center",marginRight:"16px"},children:(0,a.jsx)("span",{style:{fontSize:"24px"},children:"\uD83D\uDCC8"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{style:{fontSize:"32px",fontWeight:"700",margin:"0 0 4px 0",color:"var(--text)"},children:"Watchlist"}),(0,a.jsx)("p",{style:{color:"var(--muted)",fontSize:"16px",margin:0},children:"Track your favorite stocks and get real-time updates"})]})]})}),(0,a.jsxs)("div",{style:{background:"var(--surface)",border:"1px solid var(--border)",borderRadius:"12px",padding:"20px",marginBottom:"24px",position:"relative"},children:[(0,a.jsx)("h3",{style:{fontSize:"18px",marginBottom:"16px"},children:"Add to Watchlist"}),(0,a.jsxs)("form",{onSubmit:C,style:{display:"flex",gap:"12px",position:"relative"},children:[(0,a.jsxs)("div",{style:{flex:1,position:"relative"},children:[(0,a.jsx)("input",{type:"text",value:f,onChange:e=>m(e.target.value.toUpperCase()),onFocus:()=>w(y.length>0),placeholder:"Search for stocks (e.g., AAPL, Apple, Tesla)",style:{width:"100%",padding:"12px",border:"1px solid var(--border)",borderRadius:"8px",background:"var(--bg)",color:"var(--text)",fontSize:"16px"}}),b&&y.length>0&&(0,a.jsx)("div",{style:{position:"absolute",top:"100%",left:0,right:0,background:"var(--surface)",border:"1px solid var(--border)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.1)",zIndex:1e3,maxHeight:"200px",overflowY:"auto"},children:y.map((e,t)=>(0,a.jsxs)("div",{onClick:()=>E(e),style:{padding:"12px 16px",cursor:"pointer",borderBottom:t<y.length-1?"1px solid var(--border)":"none",display:"flex",justifyContent:"space-between",alignItems:"center",transition:"background 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="var(--bg)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:"600",fontSize:"14px"},children:e.symbol}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"var(--muted)"},children:e.name})]}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"var(--muted)"},children:e.exchange})]},e.symbol))}),S&&(0,a.jsx)("div",{style:{position:"absolute",right:"12px",top:"50%",transform:"translateY(-50%)",fontSize:"14px",color:"var(--muted)"},children:"\uD83D\uDD0D"})]}),(0,a.jsx)("button",{type:"submit",style:{background:"linear-gradient(135deg, var(--accent-warm) 0%, #f59e0b 100%)",color:"white",border:"none",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(245, 158, 11, 0.3)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none"},children:"Add"})]}),b&&(0,a.jsx)("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,zIndex:999},onClick:()=>w(!1)})]}),p&&(0,a.jsx)("div",{style:{background:"var(--danger)",color:"white",padding:"12px 16px",borderRadius:"8px",marginBottom:"16px",fontSize:"14px"},children:p}),h?(0,a.jsxs)("div",{style:{background:"var(--surface)",border:"1px solid var(--border)",borderRadius:"12px",padding:"40px",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"24px",marginBottom:"16px"},children:"â³"}),(0,a.jsx)("p",{children:"Loading watchlist..."})]}):0===s.length?(0,a.jsxs)("div",{style:{background:"var(--surface)",border:"1px solid var(--border)",borderRadius:"12px",padding:"40px",textAlign:"center"},children:[(0,a.jsx)("div",{style:{fontSize:"48px",marginBottom:"16px"},children:"\uD83D\uDCC8"}),(0,a.jsx)("h3",{style:{fontSize:"20px",marginBottom:"8px"},children:"No items in watchlist"}),(0,a.jsx)("p",{style:{color:"var(--muted)",marginBottom:"24px"},children:"Add some stocks to track their performance"})]}):(0,a.jsxs)("div",{style:{background:"var(--surface)",border:"1px solid var(--border)",borderRadius:"12px",overflow:"hidden"},children:[(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr auto",gap:"16px",padding:"16px 20px",background:"var(--bg)",borderBottom:"1px solid var(--border)",fontWeight:"600",fontSize:"14px",color:"var(--muted)"},children:[(0,a.jsx)("div",{children:"Symbol"}),(0,a.jsx)("div",{children:"Price"}),(0,a.jsx)("div",{children:"Change"}),(0,a.jsx)("div",{children:"Change %"}),(0,a.jsx)("div",{children:"Actions"})]}),s.map((e,t)=>(0,a.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr 1fr 1fr auto",gap:"16px",padding:"16px 20px",borderBottom:t<s.length-1?"1px solid var(--border)":"none",alignItems:"center"},children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{style:{fontWeight:"600",fontSize:"16px"},children:e.symbol}),(0,a.jsx)("div",{style:{fontSize:"12px",color:"var(--muted)"},children:e.name})]}),(0,a.jsx)("div",{style:{fontWeight:"600"},children:void 0!==e.price?(0,a.jsxs)(a.Fragment,{children:["GBP"===e.currency?"\xa3":"$",e.price.toFixed(2)]}):(0,a.jsx)("span",{style:{color:"var(--muted)"},children:"Loading..."})}),(0,a.jsx)("div",{style:{color:void 0!==e.change?e.change>=0?"var(--pos)":"var(--neg)":"var(--muted)",fontWeight:"600"},children:void 0!==e.change?(0,a.jsxs)(a.Fragment,{children:[e.change>=0?"+":"",e.change.toFixed(2)]}):(0,a.jsx)("span",{style:{color:"var(--muted)"},children:"-"})}),(0,a.jsx)("div",{style:{color:void 0!==e.changePercent?e.changePercent>=0?"var(--pos)":"var(--neg)":"var(--muted)",fontWeight:"600"},children:void 0!==e.changePercent?(0,a.jsxs)(a.Fragment,{children:[e.changePercent>=0?"+":"",e.changePercent.toFixed(2),"%"]}):(0,a.jsx)("span",{style:{color:"var(--muted)"},children:"-"})}),(0,a.jsx)("button",{onClick:()=>A(e.id),style:{background:"var(--danger)",color:"white",border:"none",borderRadius:"6px",padding:"8px 12px",fontSize:"12px",cursor:"pointer"},children:"Remove"})]},e.id||e.symbol))]})]})]}):(0,a.jsxs)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"var(--bg)",color:"var(--text)"},children:[(0,a.jsx)(d.Z,{title:"Watchlist - Pocket Portfolio",description:"Track your favorite stocks and investments"}),(0,a.jsx)(u.Z,{title:"Watchlist"}),(0,a.jsx)("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px"},children:(0,a.jsxs)("div",{style:{textAlign:"center"},children:[(0,a.jsx)("h1",{style:{fontSize:"24px",marginBottom:"16px"},children:"Sign in to view watchlist"}),(0,a.jsx)("p",{style:{color:"var(--muted)",marginBottom:"24px"},children:"Track your favorite stocks and get real-time updates"}),(0,a.jsx)("button",{onClick:r,style:{background:"linear-gradient(135deg, var(--accent-warm) 0%, #f59e0b 100%)",color:"white",border:"none",borderRadius:"8px",padding:"12px 24px",fontSize:"16px",fontWeight:"600",cursor:"pointer",transition:"all 0.2s ease"},children:"Sign in with Google"})]})})]})}}},function(e){e.O(0,[358,139,972,726,244,958,687,971,117,744],function(){return e(e.s=2074)}),_N_E=e.O()}]);