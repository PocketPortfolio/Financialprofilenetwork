"use strict";(()=>{var e={};e.id=634,e.ids=[634],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8938:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>m,requestAsyncStorage:()=>c,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var n={};r.r(n),r.d(n,{GET:()=>a});var l=r(49303),i=r(88716),s=r(60670),o=r(87070);async function a(e){try{let{searchParams:t}=new URL(e.url),r=t.get("tickers")||"",n=Math.min(Math.max(parseInt(t.get("limit")||"50",10),1),100);if(!r.trim())return o.NextResponse.json([]);let l=[...new Set(r.split(/[,\s]+/).map(e=>e.trim().toUpperCase()).filter(Boolean))].slice(0,50),i=l.map(async e=>{try{let t=`https://news.google.com/rss/search?q=${encodeURIComponent(e)}&hl=en-GB&gl=GB&ceid=GB:en`,r=await fetch(t,{headers:{"User-Agent":"Mozilla/5.0 (PocketPortfolio)",Accept:"application/rss+xml,text/xml,*/*"}});if(!r.ok)return[];let n=await r.text();return function(e,t){let r=[];for(let n of e.split(/<item>/i).slice(1).map(e=>e.split(/<\/item>/i)[0])){let e=u(n,"title"),l=u(n,"link")||u(n,"guid");if(!e||!l)continue;if(l.includes("news.google.com/rss/articles/"))try{let e=new URL(l).searchParams.get("url");e&&(l=e)}catch{}let i=u(n,"pubDate")||u(n,"published");r.push({title:e,url:l,source:u(n,"source")||function(e){try{return new URL(e).hostname.replace(/^www\./i,"")}catch{return""}}(l),publishedAt:i?new Date(i).toISOString():new Date().toISOString(),image:function(e){let t=e.match(/<media:content[^>]*\burl="([^"]+)"[^>]*>/i);if(t)return t[1];let r=e.match(/<enclosure[^>]*\burl="([^"]+)"[^>]*>/i);return r?r[1]:null}(n),ticker:t})}return r}(n,e)}catch(e){return[]}}),s=await Promise.all(i),a=new Map;s.forEach((e,t)=>{let r=l[t];e&&e.length>0&&a.set(r,e)});let p=1*l.length,c=Math.max(n,p);l.length;let h=[],g=[],f=[];for(let e of l){let t=a.get(e);if(t&&t.length>=1){g.push(e);for(let e=0;e<1;e++)t[e]&&h.push(t[e])}else f.push(e)}if(f.length>0)for(let e of f){let t=a.get(e);if(t&&t.length>0)for(let e=0;e<t.length;e++)h.push(t[e])}if(c-h.length>0)for(let e of l){let t=a.get(e);if(t&&t.length>1)for(let e=1;e<t.length&&h.length<c;e++)h.push(t[e])}if(h.length<n){let e=s.flat().filter(e=>!h.some(t=>t.url===e.url)).sort((e,t)=>new Date(t.publishedAt).getTime()-new Date(e.publishedAt).getTime()).slice(0,n-h.length);h.push(...e)}let m=h.sort((e,t)=>new Date(t.publishedAt).getTime()-new Date(e.publishedAt).getTime()).slice(0,n),d=new Map;m.forEach(e=>{let t=d.get(e.ticker)||0;d.set(e.ticker,t+1)});let w=[];for(let e of l)1>(d.get(e)||0)&&w.push(e);if(w.length>0)for(let e of w){let t=a.get(e);if(t&&t.length>0){let r=d.get(e)||0,n=1-r;for(let l=r;l<t.length&&l<r+n;l++)t[l]&&!m.some(e=>e.url===t[l].url)&&(m.push(t[l]),d.set(e,(d.get(e)||0)+1))}}return o.NextResponse.json(m,{headers:{"Cache-Control":"s-maxage=180, stale-while-revalidate=600","X-Data-Source":"google-news-rss-direct","X-Data-Timestamp":new Date().toISOString()}})}catch(e){return o.NextResponse.json({error:"Failed to fetch news from Google RSS"},{status:500})}}function u(e,t){let r=RegExp(`<${t}[^>]*>([\\s\\S]*?)</${t}>`,"i"),n=e.match(r);return n?n[1].replace(/<!\[CDATA\[|\]\]>/g,"").trim():""}let p=new l.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/news/route",pathname:"/api/news",filename:"route",bundlePath:"app/api/news/route"},resolvedPagePath:"C:\\Users\\fitne\\OneDrive\\pocket-portfolio-app\\app\\api\\news\\route.ts",nextConfigOutput:"",userland:n}),{requestAsyncStorage:c,staticGenerationAsyncStorage:h,serverHooks:g}=p,f="/api/news/route";function m(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),n=t.X(0,[948,972],()=>r(8938));module.exports=n})();