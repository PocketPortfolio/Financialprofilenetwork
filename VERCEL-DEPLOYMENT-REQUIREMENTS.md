# Vercel Deployment Requirements

## üîß Environment Variables to Configure

### Required for Video (NEW)
Add this to Vercel ‚Üí Project Settings ‚Üí Environment Variables:

```
NEXT_PUBLIC_DASHBOARD_DEMO_VIDEO_URL=https://res.cloudinary.com/dknmhvm7a/video/upload/v1768684914/pocket-portfolio/dashboard-demo-4k.mp4
```

**Environments**: Production, Preview, Development

### Required for PWA Push Notifications (NEW)
Add this to Vercel ‚Üí Project Settings ‚Üí Environment Variables:

```
NEXT_PUBLIC_FCM_VAPID_KEY=BLzmUhAwuQypJDgVJfCMWtetPGRF8_MqxrKcFRCSp2oqRxqSk_QmF3g-aLpzOKqAh_jmgaR5Jz9dE5zcu_9jxY4
```

**Environments**: Production, Preview, Development

### Already Configured (Verify)
These should already be set, but verify they exist:

- `NEXT_PUBLIC_FIREBASE_API_KEY`
- `NEXT_PUBLIC_FIREBASE_AUTH_DOMAIN`
- `NEXT_PUBLIC_FIREBASE_PROJECT_ID`
- `NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET`
- `NEXT_PUBLIC_FIREBASE_MESSAGING_SENDER_ID`
- `NEXT_PUBLIC_FIREBASE_APP_ID`
- `NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID`

## üì¶ Build Configuration

### Build Command
```
npm run build
```

This automatically runs:
1. `npm run build:sitemaps` - Generates sitemaps
2. `npm run build:inject-firebase` - Injects Firebase config into service worker
3. `next build` - Next.js production build

### Output Directory
```
.next
```
(Next.js default)

### Install Command
```
npm install
```

### Node Version
```
>=18.0.0
```
(Check `package.json` engines)

## ‚úÖ Pre-Deployment Checklist

- [ ] All environment variables added to Vercel
- [ ] `public/dashboard-demo-4k.mp4` exists (18.15 MB)
- [ ] `public/firebase-messaging-sw.js` exists
- [ ] `public/manifest.webmanifest` updated
- [ ] No TypeScript errors in production code (test files OK)
- [ ] No linting errors in production code

## üöÄ Deployment Steps

1. **Push to Git**: Ensure all changes are committed and pushed
2. **Verify Environment Variables**: Check Vercel dashboard
3. **Deploy**: Vercel will automatically deploy on push, or trigger manually
4. **Monitor Build**: Watch build logs for any errors
5. **Verify Deployment**:
   - Landing page video loads
   - PWA manifest accessible
   - Service workers register
   - No console errors

## üîç Post-Deployment Verification

### 1. Landing Page Video
Visit: `https://www.pocketportfolio.app/`

- [ ] Video loads and plays automatically
- [ ] Video is crisp on Retina displays
- [ ] No console errors related to video
- [ ] Fallback works if CDN fails

### 2. PWA Functionality
- [ ] Manifest loads: `https://www.pocketportfolio.app/manifest.webmanifest`
- [ ] Service worker registers (DevTools ‚Üí Application ‚Üí Service Workers)
- [ ] Install prompt appears (Android/Chrome)
- [ ] App can be installed

### 3. Firebase Messaging
- [ ] `firebase-messaging-sw.js` registered
- [ ] Settings page shows notification options
- [ ] FCM token can be generated
- [ ] No Firebase errors in console

### 4. Build Artifacts
- [ ] `.next` folder created
- [ ] `public/sw.js` exists (generated by next-pwa)
- [ ] `public/firebase-messaging-sw.js` has real config (check source)

## üêõ Troubleshooting

### Build Fails
1. Check build logs in Vercel
2. Verify all environment variables are set
3. Check Node version compatibility
4. Verify `package.json` dependencies

### Video Not Loading
1. Check `NEXT_PUBLIC_DASHBOARD_DEMO_VIDEO_URL` is set
2. Verify Cloudinary URL is accessible
3. Check browser console for CORS errors
4. Verify fallback file exists: `public/dashboard-demo-4k.mp4`

### PWA Not Working
1. Check `manifest.webmanifest` loads
2. Verify service workers register
3. Check browser console for errors
4. Ensure HTTPS is enabled (required for PWA)

### Firebase Config Not Injected
1. Check build logs for `build:inject-firebase` step
2. Verify Firebase environment variables are set
3. Check `public/firebase-messaging-sw.js` source (should have real values, not placeholders)

## üìù Notes

- **PWA**: Disabled in development, enabled in production
- **Service Workers**: Two SWs coexist (`sw.js` for caching, `firebase-messaging-sw.js` for notifications)
- **Video**: Falls back to local file if CDN fails
- **Build Time**: Firebase config injection happens during build, not runtime

---

**Last Updated**: 2025-01-17
**Status**: ‚úÖ Ready for Production Deployment

