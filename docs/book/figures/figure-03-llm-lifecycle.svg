<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 580 460" font-family="system-ui, -apple-system, Segoe UI, sans-serif" font-size="11" fill="#1e293b">
  <defs>
    <marker id="arr3" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto"><path d="M0 0 L8 3 L0 6 z" fill="#475569"/></marker>
  </defs>
  <!-- Participants -->
  <rect x="24" y="12" width="80" height="28" rx="4" fill="#f1f5f9" stroke="#475569" stroke-width="1"/>
  <text x="64" y="30" text-anchor="middle">User</text>
  <rect x="124" y="12" width="80" height="28" rx="4" fill="#f1f5f9" stroke="#475569" stroke-width="1"/>
  <text x="164" y="30" text-anchor="middle">Browser</text>
  <rect x="224" y="12" width="80" height="28" rx="4" fill="#f1f5f9" stroke="#475569" stroke-width="1"/>
  <text x="264" y="30" text-anchor="middle">Heuristic</text>
  <rect x="324" y="12" width="64" height="28" rx="4" fill="#f1f5f9" stroke="#475569" stroke-width="1"/>
  <text x="356" y="30" text-anchor="middle">API</text>
  <rect x="408" y="12" width="64" height="28" rx="4" fill="#f1f5f9" stroke="#475569" stroke-width="1"/>
  <text x="440" y="30" text-anchor="middle">LLM</text>
  <!-- Lifelines -->
  <line x1="64" y1="44" x2="64" y2="436" stroke="#cbd5e1" stroke-width="0.8" stroke-dasharray="4 2"/>
  <line x1="164" y1="44" x2="164" y2="436" stroke="#cbd5e1" stroke-width="0.8" stroke-dasharray="4 2"/>
  <line x1="264" y1="44" x2="264" y2="436" stroke="#cbd5e1" stroke-width="0.8" stroke-dasharray="4 2"/>
  <line x1="356" y1="44" x2="356" y2="436" stroke="#cbd5e1" stroke-width="0.8" stroke-dasharray="4 2"/>
  <line x1="440" y1="44" x2="440" y2="436" stroke="#cbd5e1" stroke-width="0.8" stroke-dasharray="4 2"/>
  <!-- User -> Browser: Drop CSV -->
  <path fill="none" d="M64 60 L164 60" stroke="#475569" stroke-width="1.2" marker-end="url(#arr3)"/>
  <text x="114" y="54" text-anchor="middle">Drop CSV</text>
  <!-- Browser: Parse headers + sample -->
  <rect x="174" y="72" width="200" height="26" rx="4" fill="#f8fafc" stroke="#cbd5e1" stroke-width="0.8"/>
  <text x="274" y="90" text-anchor="middle">Parse headers + sample rows</text>
  <!-- Browser -> Heuristic -->
  <path fill="none" d="M164 104 L264 104" stroke="#475569" stroke-width="1.2" marker-end="url(#arr3)"/>
  <text x="214" y="98" text-anchor="middle">inferColumnMapping(...)</text>
  <!-- Heuristic -> Browser: mapping, confidence -->
  <path fill="none" d="M264 120 L164 120" stroke="#475569" stroke-width="1.2" marker-end="url(#arr3)"/>
  <text x="214" y="114" text-anchor="middle">mapping, confidence</text>
  <!-- Alt: confidence >= 0.9 -->
  <rect x="32" y="138" width="516" height="88" rx="6" fill="#f8fafc" stroke="#94a3b8" stroke-width="0.8"/>
  <text x="56" y="158" font-weight="600" font-size="11">alt confidence &#8805; 0.9</text>
  <path fill="none" d="M64 174 L164 174" stroke="#475569" stroke-width="1"/>
  <text x="114" y="168" text-anchor="middle">genericParse(text, mapping)</text>
  <path fill="none" d="M164 192 L64 192" stroke="#475569" stroke-width="1" marker-end="url(#arr3)"/>
  <text x="114" y="186" text-anchor="middle">Show trades</text>
  <!-- Alt: confidence < 0.9 and LLM enabled -->
  <rect x="32" y="232" width="516" height="112" rx="6" fill="#f0fdf4" stroke="#94a3b8" stroke-width="0.8"/>
  <text x="56" y="252" font-weight="600" font-size="11">else confidence &lt; 0.9 and LLM enabled</text>
  <path fill="none" d="M164 272 L356 272" stroke="#475569" stroke-width="1"/>
  <text x="260" y="266" text-anchor="middle">POST headers + sampleRows (first 3)</text>
  <path fill="none" d="M356 288 L440 288" stroke="#475569" stroke-width="1"/>
  <text x="398" y="282" text-anchor="middle">Map headers &#8594; standard fields</text>
  <path fill="none" d="M440 304 L356 304" stroke="#475569" stroke-width="1" marker-end="url(#arr3)"/>
  <text x="398" y="298" text-anchor="middle">mapping</text>
  <path fill="none" d="M356 320 L164 320" stroke="#475569" stroke-width="1" marker-end="url(#arr3)"/>
  <text x="260" y="314" text-anchor="middle">mapping</text>
  <text x="274" y="336" text-anchor="middle">genericParse &#8594; Show trades or REQUIRES_MAPPING</text>
  <!-- Alt: no LLM / LLM failed -->
  <rect x="32" y="352" width="516" height="100" rx="6" fill="#fef3c7" stroke="#94a3b8" stroke-width="0.8"/>
  <text x="56" y="372" font-weight="600" font-size="11">else confidence &lt; 0.9 and no LLM / LLM failed</text>
  <path fill="none" d="M164 388 L64 388" stroke="#475569" stroke-width="1" marker-end="url(#arr3)"/>
  <text x="114" y="382" text-anchor="middle">REQUIRES_MAPPING (confirm/edit mapping)</text>
  <path fill="none" d="M64 406 L164 406" stroke="#475569" stroke-width="1"/>
  <text x="114" y="400" text-anchor="middle">Confirm mapping</text>
  <path fill="none" d="M164 422 L164 422" stroke="#475569" stroke-width="1"/>
  <text x="274" y="418" text-anchor="middle">genericParse(text, userMapping) &#8594; Show trades</text>
</svg>
